# 野火&百问

[野火科技的个人空间-野火科技个人主页-哔哩哔哩视频 (bilibili.com)](https://space.bilibili.com/356820657/channel/collectiondetail?sid=1485327)



# 软件开发流程

[嵌入式开发绝招：状态机+事件驱动框架_嵌入式状态机框架-CSDN博客](https://blog.csdn.net/FMgxth/article/details/135100923)

架构：时间片+状态机+事件+消息队列。

- 时间片：低功耗定时器驱动。
- 状态机：表驱动or switch case。
- 事件：伪事件，上层状态机。
- ~~消息队列：~~



# 规范

https://ilcc.gitbooks.io/wiki/content/StyleGuide/Huawei-C/index.html





# 基本功能

模块：

- 指纹模块。
- RF-IC card模块。
- touch key 模块+指示灯。
- 语音模块。
- 电机模块。
- RGB提示灯。
- 独立按键：开关锁按键、重置按键、防盗按键、门铃按键。
- Flash模块：存储信息。

基本功能：触摸按键及拨码菜单，指纹、密码、卡片解锁，各种提示灯，开关锁、重置、防撬、门铃单独按键，语音提示，休眠——低功耗。

触摸按键&拨码菜单：

- 触摸时唤醒，使用MCU中断唤醒功能，从休眠状态中唤醒。唤醒后拨码菜单（未进入菜单前）、指纹、卡片均正常工作——此时指纹、卡片可触发中断并解锁。
- 进入拨码菜单后，拨码菜单独占线程，指纹、卡片关断。
- 拨码菜单：各种设置功能。
- 特殊按键功能：*号键——退出与删除；#号键——确认与门铃。

RFIC-Card：

- 低功耗唤醒，读取与校验卡密。
- 卡密读取与存储。
- 刷卡灵敏度调整。

指纹：

- 

## 触摸按键

触摸芯片：GTX314L

通讯方式：I2C

流程：

1. 初始状态0，中断触发状态转移 → 状态1，唤醒与按键指示灯亮起，开始按键扫描。
2. 按键扫描，数据存入先进后出队列，
   - 当队列为空并按3次*号键触发状态转移 → 转移回初始状态0，进入休眠；
   - 当队列不为空，按到#号键，触发校验，发生状态转移 → 状态2，校验数据并提示，校验失败后退回上一状态—— 状态1
     - 校验成功后，发生状态转移，进入状态3（拨码菜单）——开始新一层状态机
   - 当无任何操作，5s号退出状态，状态转移到初始状态并进入休眠



## RFID CARD

读卡芯片：WS1850S

通讯方式：SPI





## 指纹

通讯：异步串口。

指令格式：

- 指令：包头（命令包）+数据（数据包）+包尾（结束包）。（主机 → 从机）
- 应答：确认码。（从机 → 主机）



# 蓝牙









# WiFi

## 涂鸦WiFi模块

通讯：异步串口。











## 猫眼WiFi

通讯：异步串口。























# 雷达&人脸

人脸识别模块通讯：异步串口。
